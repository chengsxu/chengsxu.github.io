{"title":"nginx常用配置","date":"2022-10-18T13:39:45.447Z","source":"_posts/nginx常用配置.md","raw":"---\ntitle: nginx常用配置\ndate: 2022-10-18 21:39:45.447\nupdated: 2022-10-18 21:39:45.447\ncategories: \ntags: \n---\nHTTPS、重定向、静态文件、分流\n<!-- more -->\n## HTTPS\n```\nupstream halo {\n  server 127.0.0.1:8090;\n}\nserver {\n  listen 443 ssl;\n  server_name chengs.run;\n  ssl_certificate  cert/chengs.run.crt;\n  ssl_certificate_key cert/chengs.run.key;\n  client_max_body_size 1024m;\n  location / {\n    proxy_pass http://halo;\n    proxy_set_header HOST $host;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n}\n```\n## 重定向\n```\nserver {\n  listen 80;\n  server_name *.chengs.run chengs.run;\n  return 301 https://$host$request_uri;\n}\n```\n## 静态文件\n```\nserver{\n    listen 443 ssl;\n    server_name note.chengs.run;\n    ssl_certificate  cert/note.chengs.run.crt;\n    ssl_certificate_key cert/note.chengs.run.key;\n    \n    root /www/notes;\n    index index.html;\n}\n```\n## 分流\n```\nserver{\n    listen 443 ssl;\n    server_name api.chengs.run;\n    ssl_certificate  cert/api.chengs.run.crt;\n    ssl_certificate_key cert/api.chengs.run.key;\n\n    location /daxuexi {\n        proxy_pass http://127.0.0.1:8000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_set_header Host $host;\n    }\n    location /botmessage/ {\n        proxy_pass http://127.0.0.1:5700/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_set_header Host $host;\n    }\n}\n```\n## 普通\n```\nserver{\n    listen 80;\n    server_name jd.chengs.run;\n    location / {\n        proxy_pass http://azure.opaw.tk:5700;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_set_header Host $host;\n    }\n}\n```","slug":"nginx常用配置","published":true,"updated":"2022-10-18T13:39:45.447Z","_id":"cm833960y001fi0q62gh985b6","comments":true,"layout":"post","photos":[],"html":"<p>HTTPS、重定向、静态文件、分流</p>\n<span id=\"more\"></span>\n<h2 id=\"HTTPS\"><a href=\"#HTTPS\" class=\"headerlink\" title=\"HTTPS\"></a>HTTPS</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream halo &#123;</span><br><span class=\"line\">  server 127.0.0.1:8090;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen 443 ssl;</span><br><span class=\"line\">  server_name chengs.run;</span><br><span class=\"line\">  ssl_certificate  cert/chengs.run.crt;</span><br><span class=\"line\">  ssl_certificate_key cert/chengs.run.key;</span><br><span class=\"line\">  client_max_body_size 1024m;</span><br><span class=\"line\">  location / &#123;</span><br><span class=\"line\">    proxy_pass http://halo;</span><br><span class=\"line\">    proxy_set_header HOST $host;</span><br><span class=\"line\">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"重定向\"><a href=\"#重定向\" class=\"headerlink\" title=\"重定向\"></a>重定向</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen 80;</span><br><span class=\"line\">  server_name *.chengs.run chengs.run;</span><br><span class=\"line\">  return 301 https://$host$request_uri;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"静态文件\"><a href=\"#静态文件\" class=\"headerlink\" title=\"静态文件\"></a>静态文件</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    server_name note.chengs.run;</span><br><span class=\"line\">    ssl_certificate  cert/note.chengs.run.crt;</span><br><span class=\"line\">    ssl_certificate_key cert/note.chengs.run.key;</span><br><span class=\"line\">    </span><br><span class=\"line\">    root /www/notes;</span><br><span class=\"line\">    index index.html;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"分流\"><a href=\"#分流\" class=\"headerlink\" title=\"分流\"></a>分流</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    server_name api.chengs.run;</span><br><span class=\"line\">    ssl_certificate  cert/api.chengs.run.crt;</span><br><span class=\"line\">    ssl_certificate_key cert/api.chengs.run.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /daxuexi &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:8000;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /botmessage/ &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:5700/;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"普通\"><a href=\"#普通\" class=\"headerlink\" title=\"普通\"></a>普通</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name jd.chengs.run;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://azure.opaw.tk:5700;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"<p>HTTPS、重定向、静态文件、分流</p>","more":"<h2 id=\"HTTPS\"><a href=\"#HTTPS\" class=\"headerlink\" title=\"HTTPS\"></a>HTTPS</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream halo &#123;</span><br><span class=\"line\">  server 127.0.0.1:8090;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen 443 ssl;</span><br><span class=\"line\">  server_name chengs.run;</span><br><span class=\"line\">  ssl_certificate  cert/chengs.run.crt;</span><br><span class=\"line\">  ssl_certificate_key cert/chengs.run.key;</span><br><span class=\"line\">  client_max_body_size 1024m;</span><br><span class=\"line\">  location / &#123;</span><br><span class=\"line\">    proxy_pass http://halo;</span><br><span class=\"line\">    proxy_set_header HOST $host;</span><br><span class=\"line\">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"重定向\"><a href=\"#重定向\" class=\"headerlink\" title=\"重定向\"></a>重定向</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen 80;</span><br><span class=\"line\">  server_name *.chengs.run chengs.run;</span><br><span class=\"line\">  return 301 https://$host$request_uri;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"静态文件\"><a href=\"#静态文件\" class=\"headerlink\" title=\"静态文件\"></a>静态文件</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    server_name note.chengs.run;</span><br><span class=\"line\">    ssl_certificate  cert/note.chengs.run.crt;</span><br><span class=\"line\">    ssl_certificate_key cert/note.chengs.run.key;</span><br><span class=\"line\">    </span><br><span class=\"line\">    root /www/notes;</span><br><span class=\"line\">    index index.html;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"分流\"><a href=\"#分流\" class=\"headerlink\" title=\"分流\"></a>分流</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    server_name api.chengs.run;</span><br><span class=\"line\">    ssl_certificate  cert/api.chengs.run.crt;</span><br><span class=\"line\">    ssl_certificate_key cert/api.chengs.run.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /daxuexi &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:8000;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /botmessage/ &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:5700/;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"普通\"><a href=\"#普通\" class=\"headerlink\" title=\"普通\"></a>普通</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name jd.chengs.run;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://azure.opaw.tk:5700;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","path":"2022/10/18/nginx常用配置/","permalink":"http://chengs.run/2022/10/18/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/","tags":[],"categories":[],"prev":{"title":"自建KMS服务器","date":"2022-10-22T03:02:20.142Z","slug":"自建KMS服务器","published":true,"updated":"2022-10-22T03:06:10.650Z","_id":"cm8339613001zi0q6hcypdf00","layout":"post","photos":[],"excerpt":"<p>window激活</p>","path":"2022/10/22/自建KMS服务器/","permalink":"http://chengs.run/2022/10/22/%E8%87%AA%E5%BB%BAKMS%E6%9C%8D%E5%8A%A1%E5%99%A8/","__post":true},"next":{"title":"shell参数解析","date":"2022-09-24T00:29:49.074Z","slug":"shell参数解析","published":true,"updated":"2022-09-24T00:48:19.756Z","_id":"cm833960z001ki0q674dh389q","layout":"post","photos":[],"excerpt":"<p>shell参数解析</p>","path":"2022/09/24/shell参数解析/","permalink":"http://chengs.run/2022/09/24/shell%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/","__post":true},"__post":true}