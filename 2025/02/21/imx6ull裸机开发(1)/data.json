{"title":"imx6ull裸机开发(1)","date":"2025-02-21T15:09:11.091Z","source":"_posts/imx6ull裸机开发(1).md","raw":"---\ntitle: imx6ull裸机开发(1)\ndate: 2025-02-21 23:09:11.091\nupdated: 2025-02-22 22:17:56.885\ncategories: \ntags: \n- imx6ull\n---\nIO使用、时钟、Cortex-A7 ArmV7介绍\n<!-- more -->\n# Cortex-A7 有 9 种运行模式\n![image](imx6ull裸机开发(1)/image.png)\n\n# CPSR寄存器\nSPSR：当异常中断发生后将CPSR寄存器保存到SPSR寄存器中，在异常中断结束后，将SPSR寄存器恢复到CPSR寄存器中\n\n其低5位可用于控制处理器模式\n![image-1740142881640](imx6ull裸机开发(1)/image-1740142881640.png)\n\n# CCM_CCGRx 使能io始终\n![image-1740144765587](imx6ull裸机开发(1)/image-1740144765587.png)\n\n# IO复用 \n配置IOMUXC_SW_MUX_CTL_PAD_GPIO1_IO03第四位为5\n![image-1740144910651](imx6ull裸机开发(1)/image-1740144910651.png)\n\n# 配置电气属性\n配置IOMUXC_SW_PAD_CTL_PAD_GPIO1_IO03\n![image-1740145252650](imx6ull裸机开发(1)/image-1740145252650.png)\n\n# 配置io输入输出 GPIOx_GDIR\n![image-1740146517022](imx6ull裸机开发(1)/image-1740146517022.png)\n\n# 配置io电平 GPIOx_DR\n![image-1740146556507](imx6ull裸机开发(1)/image-1740146556507.png)\n\n# 时钟\n主要从24Mhz晶振分出来7路时钟信号\n![image-1740223905043](imx6ull裸机开发(1)/image-1740223905043.png)\n见下图\n![image-1740223824420](imx6ull裸机开发(1)/image-1740223824420.png)\n从七路时钟信号导向不同的外设 见下图时钟树\n![image-1740224041225](imx6ull裸机开发(1)/image-1740224041225.png)\n![image-1740224066179](imx6ull裸机开发(1)/image-1740224066179.png)\n\n# 配置ARM主频为最大528MHz\n![image-1740224879270](imx6ull裸机开发(1)/image-1740224879270.png)\n\n## 配置CACRR[ARM_PODF]时钟，二分频\n![image-1740225650605](imx6ull裸机开发(1)/image-1740225650605.png)\n\n配置ARM_PODF为001\n![image-1740225699704](imx6ull裸机开发(1)/image-1740225699704.png)\n\n## 配置CCM_ANALOG_PLL_ARM[DIV_SELECT]时钟，输出为pll1_main_clk\n528 * 2 * 2 /  24 = 88\n![image-1740224857242](imx6ull裸机开发(1)/image-1740224857242.png)\n\n## 配置PLL1时钟\n在配置arm时钟前，需要通过GLITCHLESS MUX修改时钟为step_clk，通过CCSR: step_sel配置为0（24Mhz）晶振时钟\n![image-1740225292122](imx6ull裸机开发(1)/image-1740225292122.png)\n\n# 配置PLL2 528Mhz PFD0-3\n![image-1740229702156](imx6ull裸机开发(1)/image-1740229702156.png)\n\n# PLL3 480Mhz PFD0-3\n![image-1740230853689](imx6ull裸机开发(1)/image-1740230853689.png)\n\n# 其他外设时钟源\n![image-1740231015050](imx6ull裸机开发(1)/image-1740231015050.png)\n\n查表可知三者的最大时钟\n\n![image-1740231101686](imx6ull裸机开发(1)/image-1740231101686.png)\n\n配置时钟代码如下\n```c\n\n// 528Mhz\nvoid imx6u_clkinit(void)\n{\n\t// 切换系统时钟到24Mhz\n\tif (REG_BIT(CCM->CCSR, 2) == 0)\n\t{\n\t\tCCM->CCSR &= ~BIT(8);\n\t\tCCM->CCSR |= BIT(2);\n\t}\n\n#if 1\n\t// 使能PLL1 BIT(13) 配置PLL1 88分频系数 24 * 88 / 2 = 1056Mhz\n\tCCM_ANALOG->PLL_ARM = (BIT(13) | (88u & 0x7fu));\n\n\t// 配置CACRR二分频 1056Mhz / 2 = 528Mhz\n\tCCM->CACRR = 1;\n#else\n\t// 使能PLL1 BIT(13) 配置PLL1 88分频系数 24 * 58 / 2 = 696Mhz\n\tCCM_ANALOG->PLL_ARM = (BIT(13) | (58u & 0x7fu));\n\n\t// 配置CACRR1分频 696Mhz\n\tCCM->CACRR = 0;\n#endif\n\n\t// 切换时钟源为PLL1\n\tCCM->CCSR &= ~BIT(2);\n\n\t// PLL2\n\tuint32_t reg = 0;\n\treg |= 27u << 0;  // 528 * 18 / 27 = 352Mhz\n\treg |= 16u << 8;  // 528 * 18 / 16 = 594Mhz\n\treg |= 24u << 16; // 528 * 18 / 24 = 396Mhz\n\treg |= 32u << 24; // 528 * 18 / 32 = 297Mhz\n\tCCM_ANALOG->PFD_528 = reg;\n\n\t// PLL3\n\treg = 0;\n\treg |= 12u << 0;  // 480 * 18 / 12 = 720Mhz\n\treg |= 16u << 8;  // 480 * 18 / 16 = 540Mhz\n\treg |= 17u << 16; // 480 * 18 / 17 = 508.2Mhz\n\treg |= 19u << 24; // 480 * 18 / 19 = 454.7Mhz\n\tCCM_ANALOG->PFD_480 = reg;\n\n\t// 设置AHB_CLK_ROOT\n\t// 选择PLL2 PFD0的时钟396MHZ \n\t// PRE_PERIPH_CLK_SEL\n\tCCM->CBCMR &= ~(3 << 18); \n\tCCM->CBCMR |= (1 << 18); // PRE_PERIPH_CLK_SEL\n\n\t// PERIPH_CLK_SEL\n\tCCM->CBCDR &= ~(1 << 25);\n\twhile ((CCM->CDHIPR & BIT(5)));\n\n#if 0 // 不能用 仅供学习\n\t// AHB_PODF 设置AHB_CLK_ROOT 3分频 396 / 3 = 132Mhz\n\tCCM->CBCDR &= ~(7 << 10);\n\tCCM->CBCDR |= (2 << 10);\n\twhile ((CCM->CDHIPR & BIT(1)));\n#endif\n\n\t// 设置IPG_CLK_ROOT\n\t// IPG_PODF 2分频 132 / 2 = 66Mhz\n\tCCM->CBCDR &= ~(3 << 8);\n\tCCM->CBCDR |= (1 << 8);\n\n\t// 设置PERCLK_CLK_ROOT\n\t// PERCLK_PODF PERCLK_CLK_SEL 都设置为0\n\tCCM->CSCMR1 &= ~(0x7f);\n} \n```\n","slug":"imx6ull裸机开发(1)","published":true,"updated":"2025-02-22T14:17:56.885Z","_id":"cm833960n000li0q6929qavvb","comments":true,"layout":"post","photos":[],"html":"<p>IO使用、时钟、Cortex-A7 ArmV7介绍</p>\n<span id=\"more\"></span>\n<h1 id=\"Cortex-A7-有-9-种运行模式\"><a href=\"#Cortex-A7-有-9-种运行模式\" class=\"headerlink\" title=\"Cortex-A7 有 9 种运行模式\"></a>Cortex-A7 有 9 种运行模式</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image.png\" alt=\"image\"></p>\n<h1 id=\"CPSR寄存器\"><a href=\"#CPSR寄存器\" class=\"headerlink\" title=\"CPSR寄存器\"></a>CPSR寄存器</h1><p>SPSR：当异常中断发生后将CPSR寄存器保存到SPSR寄存器中，在异常中断结束后，将SPSR寄存器恢复到CPSR寄存器中</p>\n<p>其低5位可用于控制处理器模式<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740142881640.png\" alt=\"image-1740142881640\"></p>\n<h1 id=\"CCM-CCGRx-使能io始终\"><a href=\"#CCM-CCGRx-使能io始终\" class=\"headerlink\" title=\"CCM_CCGRx 使能io始终\"></a>CCM_CCGRx 使能io始终</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740144765587.png\" alt=\"image-1740144765587\"></p>\n<h1 id=\"IO复用\"><a href=\"#IO复用\" class=\"headerlink\" title=\"IO复用\"></a>IO复用</h1><p>配置IOMUXC_SW_MUX_CTL_PAD_GPIO1_IO03第四位为5<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740144910651.png\" alt=\"image-1740144910651\"></p>\n<h1 id=\"配置电气属性\"><a href=\"#配置电气属性\" class=\"headerlink\" title=\"配置电气属性\"></a>配置电气属性</h1><p>配置IOMUXC_SW_PAD_CTL_PAD_GPIO1_IO03<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740145252650.png\" alt=\"image-1740145252650\"></p>\n<h1 id=\"配置io输入输出-GPIOx-GDIR\"><a href=\"#配置io输入输出-GPIOx-GDIR\" class=\"headerlink\" title=\"配置io输入输出 GPIOx_GDIR\"></a>配置io输入输出 GPIOx_GDIR</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740146517022.png\" alt=\"image-1740146517022\"></p>\n<h1 id=\"配置io电平-GPIOx-DR\"><a href=\"#配置io电平-GPIOx-DR\" class=\"headerlink\" title=\"配置io电平 GPIOx_DR\"></a>配置io电平 GPIOx_DR</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740146556507.png\" alt=\"image-1740146556507\"></p>\n<h1 id=\"时钟\"><a href=\"#时钟\" class=\"headerlink\" title=\"时钟\"></a>时钟</h1><p>主要从24Mhz晶振分出来7路时钟信号<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740223905043.png\" alt=\"image-1740223905043\"><br>见下图<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740223824420.png\" alt=\"image-1740223824420\"><br>从七路时钟信号导向不同的外设 见下图时钟树<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224041225.png\" alt=\"image-1740224041225\"><br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224066179.png\" alt=\"image-1740224066179\"></p>\n<h1 id=\"配置ARM主频为最大528MHz\"><a href=\"#配置ARM主频为最大528MHz\" class=\"headerlink\" title=\"配置ARM主频为最大528MHz\"></a>配置ARM主频为最大528MHz</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224879270.png\" alt=\"image-1740224879270\"></p>\n<h2 id=\"配置CACRR-ARM-PODF-时钟，二分频\"><a href=\"#配置CACRR-ARM-PODF-时钟，二分频\" class=\"headerlink\" title=\"配置CACRR[ARM_PODF]时钟，二分频\"></a>配置CACRR[ARM_PODF]时钟，二分频</h2><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740225650605.png\" alt=\"image-1740225650605\"></p>\n<p>配置ARM_PODF为001<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740225699704.png\" alt=\"image-1740225699704\"></p>\n<h2 id=\"配置CCM-ANALOG-PLL-ARM-DIV-SELECT-时钟，输出为pll1-main-clk\"><a href=\"#配置CCM-ANALOG-PLL-ARM-DIV-SELECT-时钟，输出为pll1-main-clk\" class=\"headerlink\" title=\"配置CCM_ANALOG_PLL_ARM[DIV_SELECT]时钟，输出为pll1_main_clk\"></a>配置CCM_ANALOG_PLL_ARM[DIV_SELECT]时钟，输出为pll1_main_clk</h2><p>528 * 2 * 2 &#x2F;  24 &#x3D; 88<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224857242.png\" alt=\"image-1740224857242\"></p>\n<h2 id=\"配置PLL1时钟\"><a href=\"#配置PLL1时钟\" class=\"headerlink\" title=\"配置PLL1时钟\"></a>配置PLL1时钟</h2><p>在配置arm时钟前，需要通过GLITCHLESS MUX修改时钟为step_clk，通过CCSR: step_sel配置为0（24Mhz）晶振时钟<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740225292122.png\" alt=\"image-1740225292122\"></p>\n<h1 id=\"配置PLL2-528Mhz-PFD0-3\"><a href=\"#配置PLL2-528Mhz-PFD0-3\" class=\"headerlink\" title=\"配置PLL2 528Mhz PFD0-3\"></a>配置PLL2 528Mhz PFD0-3</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740229702156.png\" alt=\"image-1740229702156\"></p>\n<h1 id=\"PLL3-480Mhz-PFD0-3\"><a href=\"#PLL3-480Mhz-PFD0-3\" class=\"headerlink\" title=\"PLL3 480Mhz PFD0-3\"></a>PLL3 480Mhz PFD0-3</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740230853689.png\" alt=\"image-1740230853689\"></p>\n<h1 id=\"其他外设时钟源\"><a href=\"#其他外设时钟源\" class=\"headerlink\" title=\"其他外设时钟源\"></a>其他外设时钟源</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740231015050.png\" alt=\"image-1740231015050\"></p>\n<p>查表可知三者的最大时钟</p>\n<p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740231101686.png\" alt=\"image-1740231101686\"></p>\n<p>配置时钟代码如下</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 528Mhz</span></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">imx6u_clkinit</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 切换系统时钟到24Mhz</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (REG_BIT(CCM-&gt;CCSR, <span class=\"number\">2</span>) == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCCM-&gt;CCSR &amp;= ~BIT(<span class=\"number\">8</span>);</span><br><span class=\"line\">\t\tCCM-&gt;CCSR |= BIT(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 1</span></span><br><span class=\"line\">\t<span class=\"comment\">// 使能PLL1 BIT(13) 配置PLL1 88分频系数 24 * 88 / 2 = 1056Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PLL_ARM = (BIT(<span class=\"number\">13</span>) | (<span class=\"number\">88u</span> &amp; <span class=\"number\">0x7fu</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 配置CACRR二分频 1056Mhz / 2 = 528Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CACRR = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span></span></span><br><span class=\"line\">\t<span class=\"comment\">// 使能PLL1 BIT(13) 配置PLL1 88分频系数 24 * 58 / 2 = 696Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PLL_ARM = (BIT(<span class=\"number\">13</span>) | (<span class=\"number\">58u</span> &amp; <span class=\"number\">0x7fu</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 配置CACRR1分频 696Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CACRR = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 切换时钟源为PLL1</span></span><br><span class=\"line\">\tCCM-&gt;CCSR &amp;= ~BIT(<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// PLL2</span></span><br><span class=\"line\">\t<span class=\"type\">uint32_t</span> reg = <span class=\"number\">0</span>;</span><br><span class=\"line\">\treg |= <span class=\"number\">27u</span> &lt;&lt; <span class=\"number\">0</span>;  <span class=\"comment\">// 528 * 18 / 27 = 352Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">16u</span> &lt;&lt; <span class=\"number\">8</span>;  <span class=\"comment\">// 528 * 18 / 16 = 594Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">24u</span> &lt;&lt; <span class=\"number\">16</span>; <span class=\"comment\">// 528 * 18 / 24 = 396Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">32u</span> &lt;&lt; <span class=\"number\">24</span>; <span class=\"comment\">// 528 * 18 / 32 = 297Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PFD_528 = reg;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// PLL3</span></span><br><span class=\"line\">\treg = <span class=\"number\">0</span>;</span><br><span class=\"line\">\treg |= <span class=\"number\">12u</span> &lt;&lt; <span class=\"number\">0</span>;  <span class=\"comment\">// 480 * 18 / 12 = 720Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">16u</span> &lt;&lt; <span class=\"number\">8</span>;  <span class=\"comment\">// 480 * 18 / 16 = 540Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">17u</span> &lt;&lt; <span class=\"number\">16</span>; <span class=\"comment\">// 480 * 18 / 17 = 508.2Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">19u</span> &lt;&lt; <span class=\"number\">24</span>; <span class=\"comment\">// 480 * 18 / 19 = 454.7Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PFD_480 = reg;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置AHB_CLK_ROOT</span></span><br><span class=\"line\">\t<span class=\"comment\">// 选择PLL2 PFD0的时钟396MHZ </span></span><br><span class=\"line\">\t<span class=\"comment\">// PRE_PERIPH_CLK_SEL</span></span><br><span class=\"line\">\tCCM-&gt;CBCMR &amp;= ~(<span class=\"number\">3</span> &lt;&lt; <span class=\"number\">18</span>); </span><br><span class=\"line\">\tCCM-&gt;CBCMR |= (<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">18</span>); <span class=\"comment\">// PRE_PERIPH_CLK_SEL</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// PERIPH_CLK_SEL</span></span><br><span class=\"line\">\tCCM-&gt;CBCDR &amp;= ~(<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">25</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> ((CCM-&gt;CDHIPR &amp; BIT(<span class=\"number\">5</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 0 <span class=\"comment\">// 不能用 仅供学习</span></span></span><br><span class=\"line\">\t<span class=\"comment\">// AHB_PODF 设置AHB_CLK_ROOT 3分频 396 / 3 = 132Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CBCDR &amp;= ~(<span class=\"number\">7</span> &lt;&lt; <span class=\"number\">10</span>);</span><br><span class=\"line\">\tCCM-&gt;CBCDR |= (<span class=\"number\">2</span> &lt;&lt; <span class=\"number\">10</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> ((CCM-&gt;CDHIPR &amp; BIT(<span class=\"number\">1</span>)));</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置IPG_CLK_ROOT</span></span><br><span class=\"line\">\t<span class=\"comment\">// IPG_PODF 2分频 132 / 2 = 66Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CBCDR &amp;= ~(<span class=\"number\">3</span> &lt;&lt; <span class=\"number\">8</span>);</span><br><span class=\"line\">\tCCM-&gt;CBCDR |= (<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">8</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置PERCLK_CLK_ROOT</span></span><br><span class=\"line\">\t<span class=\"comment\">// PERCLK_PODF PERCLK_CLK_SEL 都设置为0</span></span><br><span class=\"line\">\tCCM-&gt;CSCMR1 &amp;= ~(<span class=\"number\">0x7f</span>);</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n","excerpt":"<p>IO使用、时钟、Cortex-A7 ArmV7介绍</p>","more":"<h1 id=\"Cortex-A7-有-9-种运行模式\"><a href=\"#Cortex-A7-有-9-种运行模式\" class=\"headerlink\" title=\"Cortex-A7 有 9 种运行模式\"></a>Cortex-A7 有 9 种运行模式</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image.png\" alt=\"image\"></p>\n<h1 id=\"CPSR寄存器\"><a href=\"#CPSR寄存器\" class=\"headerlink\" title=\"CPSR寄存器\"></a>CPSR寄存器</h1><p>SPSR：当异常中断发生后将CPSR寄存器保存到SPSR寄存器中，在异常中断结束后，将SPSR寄存器恢复到CPSR寄存器中</p>\n<p>其低5位可用于控制处理器模式<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740142881640.png\" alt=\"image-1740142881640\"></p>\n<h1 id=\"CCM-CCGRx-使能io始终\"><a href=\"#CCM-CCGRx-使能io始终\" class=\"headerlink\" title=\"CCM_CCGRx 使能io始终\"></a>CCM_CCGRx 使能io始终</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740144765587.png\" alt=\"image-1740144765587\"></p>\n<h1 id=\"IO复用\"><a href=\"#IO复用\" class=\"headerlink\" title=\"IO复用\"></a>IO复用</h1><p>配置IOMUXC_SW_MUX_CTL_PAD_GPIO1_IO03第四位为5<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740144910651.png\" alt=\"image-1740144910651\"></p>\n<h1 id=\"配置电气属性\"><a href=\"#配置电气属性\" class=\"headerlink\" title=\"配置电气属性\"></a>配置电气属性</h1><p>配置IOMUXC_SW_PAD_CTL_PAD_GPIO1_IO03<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740145252650.png\" alt=\"image-1740145252650\"></p>\n<h1 id=\"配置io输入输出-GPIOx-GDIR\"><a href=\"#配置io输入输出-GPIOx-GDIR\" class=\"headerlink\" title=\"配置io输入输出 GPIOx_GDIR\"></a>配置io输入输出 GPIOx_GDIR</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740146517022.png\" alt=\"image-1740146517022\"></p>\n<h1 id=\"配置io电平-GPIOx-DR\"><a href=\"#配置io电平-GPIOx-DR\" class=\"headerlink\" title=\"配置io电平 GPIOx_DR\"></a>配置io电平 GPIOx_DR</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740146556507.png\" alt=\"image-1740146556507\"></p>\n<h1 id=\"时钟\"><a href=\"#时钟\" class=\"headerlink\" title=\"时钟\"></a>时钟</h1><p>主要从24Mhz晶振分出来7路时钟信号<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740223905043.png\" alt=\"image-1740223905043\"><br>见下图<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740223824420.png\" alt=\"image-1740223824420\"><br>从七路时钟信号导向不同的外设 见下图时钟树<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224041225.png\" alt=\"image-1740224041225\"><br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224066179.png\" alt=\"image-1740224066179\"></p>\n<h1 id=\"配置ARM主频为最大528MHz\"><a href=\"#配置ARM主频为最大528MHz\" class=\"headerlink\" title=\"配置ARM主频为最大528MHz\"></a>配置ARM主频为最大528MHz</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224879270.png\" alt=\"image-1740224879270\"></p>\n<h2 id=\"配置CACRR-ARM-PODF-时钟，二分频\"><a href=\"#配置CACRR-ARM-PODF-时钟，二分频\" class=\"headerlink\" title=\"配置CACRR[ARM_PODF]时钟，二分频\"></a>配置CACRR[ARM_PODF]时钟，二分频</h2><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740225650605.png\" alt=\"image-1740225650605\"></p>\n<p>配置ARM_PODF为001<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740225699704.png\" alt=\"image-1740225699704\"></p>\n<h2 id=\"配置CCM-ANALOG-PLL-ARM-DIV-SELECT-时钟，输出为pll1-main-clk\"><a href=\"#配置CCM-ANALOG-PLL-ARM-DIV-SELECT-时钟，输出为pll1-main-clk\" class=\"headerlink\" title=\"配置CCM_ANALOG_PLL_ARM[DIV_SELECT]时钟，输出为pll1_main_clk\"></a>配置CCM_ANALOG_PLL_ARM[DIV_SELECT]时钟，输出为pll1_main_clk</h2><p>528 * 2 * 2 &#x2F;  24 &#x3D; 88<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740224857242.png\" alt=\"image-1740224857242\"></p>\n<h2 id=\"配置PLL1时钟\"><a href=\"#配置PLL1时钟\" class=\"headerlink\" title=\"配置PLL1时钟\"></a>配置PLL1时钟</h2><p>在配置arm时钟前，需要通过GLITCHLESS MUX修改时钟为step_clk，通过CCSR: step_sel配置为0（24Mhz）晶振时钟<br><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740225292122.png\" alt=\"image-1740225292122\"></p>\n<h1 id=\"配置PLL2-528Mhz-PFD0-3\"><a href=\"#配置PLL2-528Mhz-PFD0-3\" class=\"headerlink\" title=\"配置PLL2 528Mhz PFD0-3\"></a>配置PLL2 528Mhz PFD0-3</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740229702156.png\" alt=\"image-1740229702156\"></p>\n<h1 id=\"PLL3-480Mhz-PFD0-3\"><a href=\"#PLL3-480Mhz-PFD0-3\" class=\"headerlink\" title=\"PLL3 480Mhz PFD0-3\"></a>PLL3 480Mhz PFD0-3</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740230853689.png\" alt=\"image-1740230853689\"></p>\n<h1 id=\"其他外设时钟源\"><a href=\"#其他外设时钟源\" class=\"headerlink\" title=\"其他外设时钟源\"></a>其他外设时钟源</h1><p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740231015050.png\" alt=\"image-1740231015050\"></p>\n<p>查表可知三者的最大时钟</p>\n<p><img src=\"/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/image-1740231101686.png\" alt=\"image-1740231101686\"></p>\n<p>配置时钟代码如下</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 528Mhz</span></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">imx6u_clkinit</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 切换系统时钟到24Mhz</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (REG_BIT(CCM-&gt;CCSR, <span class=\"number\">2</span>) == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCCM-&gt;CCSR &amp;= ~BIT(<span class=\"number\">8</span>);</span><br><span class=\"line\">\t\tCCM-&gt;CCSR |= BIT(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 1</span></span><br><span class=\"line\">\t<span class=\"comment\">// 使能PLL1 BIT(13) 配置PLL1 88分频系数 24 * 88 / 2 = 1056Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PLL_ARM = (BIT(<span class=\"number\">13</span>) | (<span class=\"number\">88u</span> &amp; <span class=\"number\">0x7fu</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 配置CACRR二分频 1056Mhz / 2 = 528Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CACRR = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span></span></span><br><span class=\"line\">\t<span class=\"comment\">// 使能PLL1 BIT(13) 配置PLL1 88分频系数 24 * 58 / 2 = 696Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PLL_ARM = (BIT(<span class=\"number\">13</span>) | (<span class=\"number\">58u</span> &amp; <span class=\"number\">0x7fu</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 配置CACRR1分频 696Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CACRR = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 切换时钟源为PLL1</span></span><br><span class=\"line\">\tCCM-&gt;CCSR &amp;= ~BIT(<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// PLL2</span></span><br><span class=\"line\">\t<span class=\"type\">uint32_t</span> reg = <span class=\"number\">0</span>;</span><br><span class=\"line\">\treg |= <span class=\"number\">27u</span> &lt;&lt; <span class=\"number\">0</span>;  <span class=\"comment\">// 528 * 18 / 27 = 352Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">16u</span> &lt;&lt; <span class=\"number\">8</span>;  <span class=\"comment\">// 528 * 18 / 16 = 594Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">24u</span> &lt;&lt; <span class=\"number\">16</span>; <span class=\"comment\">// 528 * 18 / 24 = 396Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">32u</span> &lt;&lt; <span class=\"number\">24</span>; <span class=\"comment\">// 528 * 18 / 32 = 297Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PFD_528 = reg;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// PLL3</span></span><br><span class=\"line\">\treg = <span class=\"number\">0</span>;</span><br><span class=\"line\">\treg |= <span class=\"number\">12u</span> &lt;&lt; <span class=\"number\">0</span>;  <span class=\"comment\">// 480 * 18 / 12 = 720Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">16u</span> &lt;&lt; <span class=\"number\">8</span>;  <span class=\"comment\">// 480 * 18 / 16 = 540Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">17u</span> &lt;&lt; <span class=\"number\">16</span>; <span class=\"comment\">// 480 * 18 / 17 = 508.2Mhz</span></span><br><span class=\"line\">\treg |= <span class=\"number\">19u</span> &lt;&lt; <span class=\"number\">24</span>; <span class=\"comment\">// 480 * 18 / 19 = 454.7Mhz</span></span><br><span class=\"line\">\tCCM_ANALOG-&gt;PFD_480 = reg;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置AHB_CLK_ROOT</span></span><br><span class=\"line\">\t<span class=\"comment\">// 选择PLL2 PFD0的时钟396MHZ </span></span><br><span class=\"line\">\t<span class=\"comment\">// PRE_PERIPH_CLK_SEL</span></span><br><span class=\"line\">\tCCM-&gt;CBCMR &amp;= ~(<span class=\"number\">3</span> &lt;&lt; <span class=\"number\">18</span>); </span><br><span class=\"line\">\tCCM-&gt;CBCMR |= (<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">18</span>); <span class=\"comment\">// PRE_PERIPH_CLK_SEL</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// PERIPH_CLK_SEL</span></span><br><span class=\"line\">\tCCM-&gt;CBCDR &amp;= ~(<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">25</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> ((CCM-&gt;CDHIPR &amp; BIT(<span class=\"number\">5</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 0 <span class=\"comment\">// 不能用 仅供学习</span></span></span><br><span class=\"line\">\t<span class=\"comment\">// AHB_PODF 设置AHB_CLK_ROOT 3分频 396 / 3 = 132Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CBCDR &amp;= ~(<span class=\"number\">7</span> &lt;&lt; <span class=\"number\">10</span>);</span><br><span class=\"line\">\tCCM-&gt;CBCDR |= (<span class=\"number\">2</span> &lt;&lt; <span class=\"number\">10</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> ((CCM-&gt;CDHIPR &amp; BIT(<span class=\"number\">1</span>)));</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置IPG_CLK_ROOT</span></span><br><span class=\"line\">\t<span class=\"comment\">// IPG_PODF 2分频 132 / 2 = 66Mhz</span></span><br><span class=\"line\">\tCCM-&gt;CBCDR &amp;= ~(<span class=\"number\">3</span> &lt;&lt; <span class=\"number\">8</span>);</span><br><span class=\"line\">\tCCM-&gt;CBCDR |= (<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">8</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置PERCLK_CLK_ROOT</span></span><br><span class=\"line\">\t<span class=\"comment\">// PERCLK_PODF PERCLK_CLK_SEL 都设置为0</span></span><br><span class=\"line\">\tCCM-&gt;CSCMR1 &amp;= ~(<span class=\"number\">0x7f</span>);</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>","path":"2025/02/21/imx6ull裸机开发(1)/","permalink":"http://chengs.run/2025/02/21/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(1)/","tags":[{"name":"imx6ull","_id":"cm833960s000wi0q61oy1go6a","slug":"imx6ull","path":"tags/imx6ull/","permalink":"http://chengs.run/tags/imx6ull/","length":4}],"categories":[],"prev":{"title":"imx6ull裸机开发(2)","date":"2025-02-22T14:55:20.555Z","slug":"imx6ull裸机开发(2)","published":true,"updated":"2025-02-22T17:36:08.118Z","_id":"cm833960q000qi0q6agka6dgl","layout":"post","photos":[],"excerpt":"<p>GIC介绍、中断函数过程</p>","path":"2025/02/22/imx6ull裸机开发(2)/","permalink":"http://chengs.run/2025/02/22/imx6ull%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91(2)/","__post":true},"next":{"title":"Makefile模板","date":"2025-02-21T11:20:04.288Z","slug":"Makefile模板","published":true,"updated":"2025-02-23T12:20:21.920Z","_id":"cm833960g0008i0q656yg7jum","layout":"post","photos":[],"excerpt":"<p>Makefile模板</p>","path":"2025/02/21/Makefile模板/","permalink":"http://chengs.run/2025/02/21/Makefile%E6%A8%A1%E6%9D%BF/","__post":true},"__post":true}