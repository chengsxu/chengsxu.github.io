{"title":"Markdown图片base64压缩","date":"2021-12-19T10:05:22.959Z","source":"_posts/Markdown图片base64压缩.md","raw":"---\ntitle: Markdown图片base64压缩\ndate: 2021-12-19 18:05:22.959\nupdated: 2021-12-19 18:44:14.314\ncategories: \ntags: \n---\nMarkdown图片压缩到文件中\n<!-- more -->\n```python\n#coding=utf-8\nimport base64\nimport time\nimport os\nimport re\n \n\nname = 'hhh'\nfilename = name + \".md\"\ntemfile = name + 'base64' + \".md\"\n\ndef create_file(path):\n    picdir = path +'assets\\\\'\n    ls = os.listdir(picdir)\n    targetfile = path + temfile\n    print(targetfile)\n    for i in ls :\n        mulu=str(picdir)+str(i)\n        f=open(mulu,\"rb\")   #以二进制形式打开str(ls_f)[2:-1]\n        ls_f = base64.b64encode(f.read())\n        link = 'assets/'+i\n        link_str = '\\r\\n' + f\"[{link}]:data:image/png;base64,\" + str(ls_f)[2:-1] \n        #print(link_str)\n        with open(targetfile, 'a+',  encoding='utf-8') as file:\n            file.write(link_str)\n\ndef change(path):\n    tar = path + filename\n    tars = path + temfile\n\n    picdir = path +'assets\\\\'\n    ls = os.listdir(picdir)\n\n    with open(tar, 'r+', encoding='utf-8') as f:            \n        lines = f.readlines()\n        for line in lines:\n            for i in ls:\n                if i in line:\n                    line = f\"![{i[0:-4]}][assets/{i}]\"+ '\\n'\n            with open(tars, 'a+',  encoding='utf-8') as file:\n                file.write(line)\n\nif __name__ == '__main__':\n    start=time.time()\n    path=os.getcwd()+'\\\\'\n    ls = os.listdir(path)\n    for i in ls:\n        res = re.findall(r'(.*?).md',i)\n        if len(res):\n            name = res[0]\n            filename = name + \".md\"\n            temfile = name + 'base64' + \".md\"\n            break\n    for i in ls:\n        res = re.findall(r'(.*?)base64.md',i)\n        if len(res):\n            rmfile = path + temfile\n            os.remove(rmfile) \n    print(filename)\n    change(path)\n    create_file(path)\n    print('post time:',time.time()-start)\n\n```","slug":"Markdown图片base64压缩","published":true,"updated":"2021-12-19T10:44:14.314Z","_id":"cm833960h000ai0q69dew42qk","comments":true,"layout":"post","photos":[],"html":"<p>Markdown图片压缩到文件中</p>\n<span id=\"more\"></span>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">name = <span class=\"string\">&#x27;hhh&#x27;</span></span><br><span class=\"line\">filename = name + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\">temfile = name + <span class=\"string\">&#x27;base64&#x27;</span> + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_file</span>(<span class=\"params\">path</span>):</span><br><span class=\"line\">    picdir = path +<span class=\"string\">&#x27;assets\\\\&#x27;</span></span><br><span class=\"line\">    ls = os.listdir(picdir)</span><br><span class=\"line\">    targetfile = path + temfile</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(targetfile)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls :</span><br><span class=\"line\">        mulu=<span class=\"built_in\">str</span>(picdir)+<span class=\"built_in\">str</span>(i)</span><br><span class=\"line\">        f=<span class=\"built_in\">open</span>(mulu,<span class=\"string\">&quot;rb&quot;</span>)   <span class=\"comment\">#以二进制形式打开str(ls_f)[2:-1]</span></span><br><span class=\"line\">        ls_f = base64.b64encode(f.read())</span><br><span class=\"line\">        link = <span class=\"string\">&#x27;assets/&#x27;</span>+i</span><br><span class=\"line\">        link_str = <span class=\"string\">&#x27;\\r\\n&#x27;</span> + <span class=\"string\">f&quot;[<span class=\"subst\">&#123;link&#125;</span>]:data:image/png;base64,&quot;</span> + <span class=\"built_in\">str</span>(ls_f)[<span class=\"number\">2</span>:-<span class=\"number\">1</span>] </span><br><span class=\"line\">        <span class=\"comment\">#print(link_str)</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(targetfile, <span class=\"string\">&#x27;a+&#x27;</span>,  encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">            file.write(link_str)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">change</span>(<span class=\"params\">path</span>):</span><br><span class=\"line\">    tar = path + filename</span><br><span class=\"line\">    tars = path + temfile</span><br><span class=\"line\"></span><br><span class=\"line\">    picdir = path +<span class=\"string\">&#x27;assets\\\\&#x27;</span></span><br><span class=\"line\">    ls = os.listdir(picdir)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(tar, <span class=\"string\">&#x27;r+&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:            </span><br><span class=\"line\">        lines = f.readlines()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> line:</span><br><span class=\"line\">                    line = <span class=\"string\">f&quot;![<span class=\"subst\">&#123;i[<span class=\"number\">0</span>:-<span class=\"number\">4</span>]&#125;</span>][assets/<span class=\"subst\">&#123;i&#125;</span>]&quot;</span>+ <span class=\"string\">&#x27;\\n&#x27;</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(tars, <span class=\"string\">&#x27;a+&#x27;</span>,  encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">                file.write(line)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    start=time.time()</span><br><span class=\"line\">    path=os.getcwd()+<span class=\"string\">&#x27;\\\\&#x27;</span></span><br><span class=\"line\">    ls = os.listdir(path)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls:</span><br><span class=\"line\">        res = re.findall(<span class=\"string\">r&#x27;(.*?).md&#x27;</span>,i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(res):</span><br><span class=\"line\">            name = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">            filename = name + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\">            temfile = name + <span class=\"string\">&#x27;base64&#x27;</span> + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls:</span><br><span class=\"line\">        res = re.findall(<span class=\"string\">r&#x27;(.*?)base64.md&#x27;</span>,i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(res):</span><br><span class=\"line\">            rmfile = path + temfile</span><br><span class=\"line\">            os.remove(rmfile) </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(filename)</span><br><span class=\"line\">    change(path)</span><br><span class=\"line\">    create_file(path)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;post time:&#x27;</span>,time.time()-start)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","excerpt":"<p>Markdown图片压缩到文件中</p>","more":"<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">name = <span class=\"string\">&#x27;hhh&#x27;</span></span><br><span class=\"line\">filename = name + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\">temfile = name + <span class=\"string\">&#x27;base64&#x27;</span> + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_file</span>(<span class=\"params\">path</span>):</span><br><span class=\"line\">    picdir = path +<span class=\"string\">&#x27;assets\\\\&#x27;</span></span><br><span class=\"line\">    ls = os.listdir(picdir)</span><br><span class=\"line\">    targetfile = path + temfile</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(targetfile)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls :</span><br><span class=\"line\">        mulu=<span class=\"built_in\">str</span>(picdir)+<span class=\"built_in\">str</span>(i)</span><br><span class=\"line\">        f=<span class=\"built_in\">open</span>(mulu,<span class=\"string\">&quot;rb&quot;</span>)   <span class=\"comment\">#以二进制形式打开str(ls_f)[2:-1]</span></span><br><span class=\"line\">        ls_f = base64.b64encode(f.read())</span><br><span class=\"line\">        link = <span class=\"string\">&#x27;assets/&#x27;</span>+i</span><br><span class=\"line\">        link_str = <span class=\"string\">&#x27;\\r\\n&#x27;</span> + <span class=\"string\">f&quot;[<span class=\"subst\">&#123;link&#125;</span>]:data:image/png;base64,&quot;</span> + <span class=\"built_in\">str</span>(ls_f)[<span class=\"number\">2</span>:-<span class=\"number\">1</span>] </span><br><span class=\"line\">        <span class=\"comment\">#print(link_str)</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(targetfile, <span class=\"string\">&#x27;a+&#x27;</span>,  encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">            file.write(link_str)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">change</span>(<span class=\"params\">path</span>):</span><br><span class=\"line\">    tar = path + filename</span><br><span class=\"line\">    tars = path + temfile</span><br><span class=\"line\"></span><br><span class=\"line\">    picdir = path +<span class=\"string\">&#x27;assets\\\\&#x27;</span></span><br><span class=\"line\">    ls = os.listdir(picdir)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(tar, <span class=\"string\">&#x27;r+&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:            </span><br><span class=\"line\">        lines = f.readlines()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> line:</span><br><span class=\"line\">                    line = <span class=\"string\">f&quot;![<span class=\"subst\">&#123;i[<span class=\"number\">0</span>:-<span class=\"number\">4</span>]&#125;</span>][assets/<span class=\"subst\">&#123;i&#125;</span>]&quot;</span>+ <span class=\"string\">&#x27;\\n&#x27;</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(tars, <span class=\"string\">&#x27;a+&#x27;</span>,  encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">                file.write(line)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    start=time.time()</span><br><span class=\"line\">    path=os.getcwd()+<span class=\"string\">&#x27;\\\\&#x27;</span></span><br><span class=\"line\">    ls = os.listdir(path)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls:</span><br><span class=\"line\">        res = re.findall(<span class=\"string\">r&#x27;(.*?).md&#x27;</span>,i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(res):</span><br><span class=\"line\">            name = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">            filename = name + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\">            temfile = name + <span class=\"string\">&#x27;base64&#x27;</span> + <span class=\"string\">&quot;.md&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ls:</span><br><span class=\"line\">        res = re.findall(<span class=\"string\">r&#x27;(.*?)base64.md&#x27;</span>,i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(res):</span><br><span class=\"line\">            rmfile = path + temfile</span><br><span class=\"line\">            os.remove(rmfile) </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(filename)</span><br><span class=\"line\">    change(path)</span><br><span class=\"line\">    create_file(path)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;post time:&#x27;</span>,time.time()-start)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","path":"2021/12/19/Markdown图片base64压缩/","permalink":"http://chengs.run/2021/12/19/Markdown%E5%9B%BE%E7%89%87base64%E5%8E%8B%E7%BC%A9/","tags":[],"categories":[],"prev":{"title":"docker创建镜像上传","date":"2022-01-16T09:27:10.939Z","slug":"docker创建镜像上传","published":true,"updated":"2022-01-16T09:27:10.939Z","_id":"cm833960l000hi0q64tmcejwg","layout":"post","photos":[],"excerpt":"<p>docker创建镜像上传</p>","path":"2022/01/16/docker创建镜像上传/","permalink":"http://chengs.run/2022/01/16/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0/","__post":true},"next":{"title":"VPS探针","date":"2021-12-19T04:46:09.407Z","slug":"VPS探针","published":true,"updated":"2021-12-19T06:20:47.307Z","_id":"cm833960j000di0q6fff005h5","layout":"post","photos":[],"excerpt":"<p>vps状态实时监测</p>","path":"2021/12/19/VPS探针/","permalink":"http://chengs.run/2021/12/19/VPS%E6%8E%A2%E9%92%88/","__post":true},"__post":true}